<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Groupie Tracker - Évènements</title>
    <link rel="stylesheet" href="/css/accueil.css">
    <link rel="stylesheet" href="/css/concerts.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 700px; width: 95%; margin: 20px auto; border-radius: 15px; border: 2px solid #333; z-index: 1; }
        #container-groupie_title { position: relative; z-index: 1000; }
    </style>
</head>
<body>
    <div id="container-groupie_title">
        <nav>
            <div class="groupie_title">
                <h1><a href="/">GROUPIE TRACKER</a></h1>
            </div>
            <div class="search-bar">
                <form class="search-form" action="/search" method="POST">
                    <input required placeholder="Rechercher un artiste..." id="text-search" type="text" name="search-bar"/>
                    <button type="submit">Search</button>
                </form>
            </div>
            <ul class="groupie_artists">
                <li><a href="/">Accueil</a></li>
                <li><a href="/artists">Artistes</a></li>
                <li><a href="/concerts">Évènements</a></li>
            </ul>
        </nav>
    </div>

    <div id="map" data-markers="{{.MarkersJSON}}"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var mapElement = document.getElementById('map');
            var rawData = mapElement.getAttribute('data-markers');
            
            // Initialisation Map
            var map = L.map('map').setView([20, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(map);

            try {
                var markers = JSON.parse(rawData);
                if (markers && markers.length > 0) {
                    var group = new L.featureGroup();
                    markers.forEach(function(loc) {
                        var city = loc.city.replace(/_/g, ' ').replace(/-/g, ', ');
                        var m = L.marker([loc.lat, loc.lng])
                                 .addTo(map)
                                 .bindPopup("<b>"+loc.artist+"</b><br>"+city);
                        group.addLayer(m);
                    });
                    // Si on a filtré un artiste, on zoome sur ses concerts
                    map.fitBounds(group.getBounds(), {padding: [50, 50]});
                }
            } catch (e) { console.error("JSON Error", e); }
        });
    </script>
</body>
</html>