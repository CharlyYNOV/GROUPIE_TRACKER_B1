<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Groupie Tracker - Évènements</title>
    <link rel="stylesheet" href="/css/accueil.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        #map { height: 700px; width: 95%; margin: 20px auto; border-radius: 15px}  /*style's map*/
    </style>
</head>
<body>  
    <!-- up main menu-->
    <div id="container-groupie_title">
        <nav>
            <div class="groupie_title">
                <h1><a href="/">GROUPIE TRACKER</a></h1>
            </div>
            <div class="search-bar">
                    <form class="search-form" action="/search" method="POST">
                        <div class="input-container">
                            <input required placeholder="Search artists..." class="search-input" id="text-search" type="text" name="search-bar" list="suggestions-list" autocomplete="off"/>
                            <a href="/concerts" style="text-decoration: none; color: #666; font-size: 13px; margin-left: 10px; align-self: center;">
                            Supprimer la recherche
                            <datalist id="suggestions-list">
                                {{range $artist := .Artists}}
                                <option value="{{$artist.Name}}">{{$artist.Name}}</option>
                                {{range $artist.Members}}
                                <option value="{{.}}">{{.}} (member of {{$artist.Name}})</option>
                                {{end}}
                                {{end}}
                            </datalist>
                        </div>

                        <button class="submit-button" type="submit">
                            <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="icon-submit">
                                <path d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor"></path>
                            </svg>
                            <p>Search</p>
                        </button>
                    </form>
                </div>
            <ul class="groupie_artists">
                <li><a href="/">Accueil</a></li>
                <li><a href="/artists">Artistes</a></li>
                <li><a href="/concerts">Évènements</a></li>
            </ul>
        </nav>
    </div>
    
    <!--end of up main menu -->

    <div id="map" data-markers="{{.MarkersJSON}}"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>  <!--Leaflet Api-->
    
    <script>
            var mapElement = document.getElementById('map');
            var rawData = mapElement.getAttribute('data-markers'); //retrieve information from the go
            var map = L.map('map').setView([20, 0], 2); //see map

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(map); //weird thing from the api to see the map

            try {
                if (rawData && rawData !== "") {
                    var markers = JSON.parse(rawData);
                    if (markers && markers.length > 0) {
                        var group = new L.featureGroup();
                        markers.forEach(function(loc) { //prettier
                            var city = loc.city.replace(/_/g, ' ').replace(/-/g, ', ');
                            var m = L.marker([loc.lat, loc.lng])
                                     .addTo(map)
                                     .bindPopup("<b>"+loc.artist+"</b><br>"+city);
                        });
                    }
                }
            } catch (e) { console.error("Erreur de chargement", e); }
    </script>
</body>
</html>