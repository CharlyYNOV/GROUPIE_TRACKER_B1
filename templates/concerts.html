<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groupie Tracker - Évènements</title>
    
    <link rel="stylesheet" href="/css/concerts.css">
    <link rel="stylesheet" href="/css/accueil.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
     
    <style>
        /* On s'assure que la map a une taille et ne cache pas le reste */
        #map { 
            height: 700px; 
            width: 95%; 
            margin: 20px auto; 
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1; 
        }
        /* Fix pour que ton menu reste cliquable */
        #container-groupie_title {
            position: relative;
            z-index: 1000;
        }
    </style>
</head>

<body>
    <div id="container-groupie_title">
        <nav>
            <div class="groupie_title">
                <h1><a href="/">GROUPIE TRACKER</a></h1>
            </div>
            <div class="search-bar">
                <form class="search-form" action="/search" method="POST">
                    <div class="input-container">
                        <input required placeholder="Search artists..." class="search-input" id="text-search" type="text" name="search-bar"/>
                    </div>
                    <button class="submit-button" type="submit">
                        <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="icon-submit">
                            <path d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor"></path>
                        </svg>
                        <p>Search</p>
                    </button>
                </form>
            </div>
            <ul class="groupie_artists">
                <li><a href="/" class="nav-link">Accueil</a></li>
                <li><a href="/artists" class="nav-link">Artistes</a></li>
                <li><a href="/concerts" class="nav-link">Évènements</a></li>
            </ul>
        </nav>
    </div>

    <div id="map" data-markers="{{.MarkersJSON}}"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var mapElement = document.getElementById('map');
            var rawData = mapElement.getAttribute('data-markers');

            // Init Map (vue sur l'Europe)
            var map = L.map('map').setView([40, 10], 3);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; OpenStreetMap'
            }).addTo(map);

            // Petit délai pour éviter le bug d'affichage blanc
            setTimeout(function(){ map.invalidateSize() }, 500);

            try {
                var markers = JSON.parse(rawData);
                if (Array.isArray(markers)) {
                    markers.forEach(function(loc) {
                        if (loc.lat !== 0) {
                            var cityDisplay = loc.city.replace(/_/g, ' ').replace(/-/g, ', ');
                            L.marker([loc.lat, loc.lng])
                                .addTo(map)
                                .bindPopup(`<b>${loc.artist}</b><br>${cityDisplay}`);
                        }
                    });
                }
            } catch (e) {
                console.error("Erreur JSON:", e);
            }
        });
    </script>
</body>
</html>